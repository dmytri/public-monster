<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>public.monster</title>
<script type="module">
import { register } from '/hanko-elements.js';
register('HANKO_API_URL_PLACEHOLDER');
</script>
<style>
  body{background:#008080;color:#000;font-family:"Comic Sans MS",cursive;margin:20px}
  main{background:#c0c0c0;border:4px outset #fff;padding:20px;max-width:800px;margin:0 auto}
  .blink{animation:blink 1s infinite}@keyframes blink{50%{opacity:0}}
  #auth{display:block}#upload{display:none}
</style>
</head>
<body>
<main>
  <h1>ğŸŒ Welcome to public.monster! ğŸŒ</h1>
  <p class="blink">âš¡ Your personal corner of the web! âš¡</p>

  <div id="auth">
    <hanko-auth experimental="passkey:disabled,password:disabled,mfa:disabled"></hanko-auth>
  </div>

  <div id="upload">
    <h2>Upload Your Site</h2>
    <form id="u">
      <input type="file" id="f" multiple>
      <button type="submit">ğŸš€ Upload</button><p id="s"></p>
    </form>
    Your site: <a id="l" target="_blank"></a>
  </div>
</main>

<script>
window.addEventListener('hankoReady', async () => {
  document.getElementById('auth').style.display='none';
  document.getElementById('upload').style.display='block';

  const uid = await window.hanko.user.getCurrent().id;
  const a = document.getElementById('l');
  a.href='/~'+uid; a.textContent='/~'+uid;

  document.getElementById('u').onsubmit=async(e=>{
    e.preventDefault();
    const s=document.getElementById('s'), files=document.getElementById('f').files;
    s.textContent='Uploading...';
    for(let i=0;i<files.length;i++){
      const form=new FormData();
      form.append('file', files[i]);
      form.append('path', files[i].name);
      await fetch('/upload',{
        method:'POST',
        body:form,
        headers:{Authorization:`Bearer ${await window.hanko.session.getJWT()}`}
      });
    }
    s.textContent='âœ… Done!';
  });
});
</script>
</body>
</html>
