<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>public.monster - Your Public HTML Space</title>
<script type="module">
import { register } from '/hanko-elements.js';
const hankoApi = 'HANKO_API_URL_PLACEHOLDER';
if (hankoApi) {
  register(hankoApi).then(() => {
    console.log('Hanko registered successfully');
    window.dispatchEvent(new Event('hanko-ready'));
  }).catch(err => {
    console.error('Hanko registration failed:', err);
  });
} else {
  console.error('HANKO_API_URL not set');
}
</script>
<style>
body{background:#008080;color:#000;font-family:"Comic Sans MS",cursive;margin:20px}
main{background:#c0c0c0;border:4px outset #fff;padding:20px;max-width:800px;margin:0 auto}
h1{color:#ff00ff;text-shadow:2px 2px #000;font-size:2.5em;margin:0}
h2{color:#00f;text-decoration:underline}
form{background:#fff;border:2px inset #999;padding:15px;margin:20px 0}
input,button{font-family:inherit;font-size:1em;margin:5px}
button{background:#c0c0c0;border:2px outset #fff;padding:5px 15px;cursor:pointer}
button:active{border-style:inset}
a{color:#00f;text-decoration:underline}
.blink{animation:blink 1s infinite}
@keyframes blink{50%{opacity:0}}
#auth{display:block}
#upload{display:none}
</style>
</head>
<body>
<main role="main">
<h1>üåê Welcome to public.monster! üåê</h1>
<p class="blink">‚ö° Your personal corner of the web! ‚ö°</p>
<div id="auth">
<h2>Login / Sign Up</h2>
<hanko-auth></hanko-auth>
</div>
<div id="upload">
<h2>Upload Your Site</h2>
<form id="uploadForm" aria-label="Upload files">
<label for="files">Files: <input id="files" type="file" multiple></label><br>
<label for="folder">Folder: <input id="folder" type="file" webkitdirectory></label><br>
<button type="submit" id="btn">üöÄ Upload</button>
<p id="status"></p>
</form>
<p>Your site: <a href="#" id="link"></a></p>
</div>
<script>
window.addEventListener('hanko-ready', () => {
  console.log('Hanko ready');
  const hankoEl = document.querySelector('hanko-auth');

hankoEl.addEventListener('onSessionCreated', (event) => {
  console.log('Session created:', event.detail);
});

hankoEl.addEventListener('onUserCreated', (event) => {
  console.log('User created:', event.detail);
});

hankoEl.addEventListener('onAuthFlowCompleted', async (event) => {
  console.log('Auth flow completed:', event.detail);
  try {
    const hanko = event.detail.hanko;
    const session = await hanko.session.get();
    const user = await hanko.user.getCurrent();
    console.log('User:', user.id, 'Session:', session.jwt.substring(0, 20) + '...');
  
  document.getElementById('auth').style.display = 'none';
  document.getElementById('upload').style.display = 'block';
  document.getElementById('link').href = `/~${user.id}`;
  document.getElementById('link').textContent = `/~${user.id}`;
  
  document.getElementById('uploadForm').onsubmit = async(e) => {
    e.preventDefault();
    const btn = document.getElementById('btn');
    const status = document.getElementById('status');
    const files = [...document.getElementById('files').files, ...document.getElementById('folder').files];
    btn.disabled = true;
    status.textContent = 'Uploading...';
    for(let i = 0; i < files.length; i++) {
      const f = files[i];
      status.textContent = `Uploading ${i+1}/${files.length}: ${f.name}`;
      const form = new FormData();
      form.append('file', f);
      form.append('path', f.webkitRelativePath || f.name);
      await fetch('/upload', {method: 'POST', body: form, headers: {'Authorization': `Bearer ${session.jwt}`}});
    }
    status.textContent = '‚úÖ Done!';
    btn.disabled = false;
  };
  } catch(err) {
    console.error('Auth error:', err);
    alert('Auth error: ' + err.message);
  }
});

hankoEl.addEventListener('onError', (event) => {
  console.error('Hanko error:', event.detail);
  alert('Hanko error: ' + JSON.stringify(event.detail));
});
});
</script>
<footer style="text-align:center;margin-top:40px;padding-top:20px;border-top:2px groove #999;font-size:0.9em">
by <a href="https://dmytri.to" target="_blank" rel="noopener">dmytri.to</a>
</footer>
</main>
</body>
</html>
