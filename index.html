<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="robots" content="index, follow">
<meta name="theme-color" content="#008080">
<link rel="canonical" href="https://public.monster/">
<!-- Bunny Fonts -->
<link rel="preconnect" href="https://fonts.bunny.net">
<link href="https://fonts.bunny.net/css?family=anton:400|comic-neue:400,700" rel="stylesheet">
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸŒ</text></svg>">
<title>public.monster</title>
<meta name="description" content="Your personal corner of the web. Upload HTML and go live instantly at public.monster/~yourusername">
<!-- Open Graph -->
<meta property="og:title" content="public.monster">
<meta property="og:description" content="Remember when the web was fun? Upload your HTML and go live instantly.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://public.monster">
<meta property="og:site_name" content="public.monster">
<meta property="og:image" content="https://public.monster/social-card.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="public.monster">
<meta name="twitter:description" content="Your personal corner of the web. Upload HTML and go live instantly.">
<meta name="twitter:image" content="https://public.monster/social-card.png">
<!-- IndieWeb -->
<link rel="me" href="https://public.monster/~dmytri">
<link rel="author" href="https://public.monster/~dmytri">
<!-- Privacy-friendly analytics by Plausible -->
<script async src="https://plausible.io/js/pa-neokOJSyQG1cGL1NXRHGs.js"></script>
<script>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()
</script>
<script type="module">
import { register } from "https://esm.run/@teamhanko/hanko-elements";

let currentUserId = null;
let hankoToken = null;

const { hanko } = await register("HANKO_API_URL_PLACEHOLDER");

const showAuth = () => {
  document.getElementById('auth').style.display = 'block';
  document.getElementById('upload').style.display = 'none';
};

const showUpload = async (userId) => {
  currentUserId = userId;
  document.getElementById('auth').style.display = 'none';
  document.getElementById('upload').style.display = 'block';
  document.getElementById('link').href = '/~' + userId + '/';
  document.getElementById('link').textContent = '/~' + userId + '/';
  
  // Check if index.html exists
  try {
    const res = await fetch('/api/files', {
      headers: { 'Authorization': 'Bearer ' + window.hankoToken }
    });
    if (res.ok) {
      const files = await res.json();
      const hasIndex = files.some(f => f.ObjectName === 'index.html');
      document.getElementById('starterSection').style.display = hasIndex ? 'none' : 'block';
    }
  } catch (e) {
    console.error('Failed to check for index.html', e);
  }
};

hanko.onSessionCreated(async (event) => {
  window.hankoToken = await hanko.getSessionToken();
  const user = await hanko.getUser(); 
  const userId = user.username;
  showUpload(userId);
});

const token = await hanko.getSessionToken();
if (token) {
  window.hankoToken = token;
  const user = await hanko.getUser(); 
  const userId = user.username;
  console.log(user);
  showUpload(userId);
}
</script>
<style>
body{background:#008080;color:#000;font-family:"Comic Neue","Comic Sans MS",cursive;margin:20px}
main{background:#c0c0c0;border:4px outset #fff;padding:20px;max-width:800px;margin:0 auto;position:relative}
h1{color:#ff00ff;font-family:Anton,Impact,"Arial Black",sans-serif;text-shadow:3px 3px 0 #000,5px 5px 10px rgba(0,0,0,0.5);font-size:2.5em;margin:0;letter-spacing:1px}
h2{color:#000;background:#ff0;padding:5px 10px;display:inline-block}
form{background:#fff;border:2px inset #999;padding:15px;margin:20px 0}
input,button{font-family:inherit;font-size:1em;margin:5px}
button{background:#c0c0c0;border:2px outset #fff;padding:5px 15px;cursor:pointer}
button:active{border-style:inset}
a{color:#00f;text-decoration:underline}
.blink{font-size:2em;animation:blink 1.5s infinite}
@keyframes blink{50%{opacity:0}}
#auth{display:block}
#upload{display:none}
.beta-badge{position:absolute;top:-10px;right:-10px;background:#ff0;color:#f00;font-weight:bold;font-size:1.5em;padding:8px 16px;border:3px solid #f00;transform:rotate(15deg);box-shadow:3px 3px 0 #000;z-index:1000}
.construction{text-align:center;margin:20px 0;font-size:1em;background:#ff69b4;color:#000;padding:10px;font-weight:bold}
@media(max-width:600px){h1{font-size:1.5em}h2{font-size:1.2em}.beta-badge{font-size:1.2em;padding:6px 12px}}
</style>
</head>
<body>
<main role="main">
<div class="beta-badge">BETA</div>
<h1>ğŸŒ Welcome to public.monster! ğŸŒ</h1>
<div id="auth">
<p class="blink">âš¡ Your personal corner of the web! âš¡</p>
<h2>Login / Sign Up</h2>
<hanko-auth mode="registration"></hanko-auth>
</div>
<div id="upload">
<h2>Upload Your Site</h2>
<form id="uploadForm" aria-label="Upload files">
<label for="files">Files: <input id="files" type="file" multiple></label><br>
<label for="folder">Folder: <input id="folder" type="file" webkitdirectory></label><br>
<label for="flattenFolder"><input id="flattenFolder" type="checkbox"> Upload folder contents to root (strip folder name)</label>
<p>âš ï¸ <strong>Important: index.html</strong> must be in the root, NOT in a subfolder! <strong>Read this!</strong>: <a href="/faq">FAQ</a></p>
<button type="submit" id="btn">ğŸš€ Upload</button>
<p id="status"></p>
</form>
<p id="starterSection" style="display:none">
<button type="button" id="createStarter">âœ¨ Create Starter Page</button>
<span id="starterStatus"></span>
</p>
<p><strong>Your site:</strong> <a href="#" id="link"></a></p>
<p><a href="/filemanager">ğŸ“ File Manager</a> | <a href="/profile">ğŸ‘¤ Profile</a></p>
</div>
<script>
const form = document.getElementById('uploadForm');
const status = document.getElementById('status');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  const filesInput = document.getElementById('files');
  const folderInput = document.getElementById('folder');
  const files = [...(filesInput.files || []), ...(folderInput.files || [])];
  
  if (files.length === 0) {
    status.textContent = 'âŒ No files selected';
    return;
  }
  
  status.textContent = `â³ Uploading ${files.length} file(s)...`;
  
  const flattenFolder = document.getElementById('flattenFolder').checked;
  
  let count = 0;
  for (const file of files) {
    count++;
    status.textContent = `â³ Uploading ${count}/${files.length}: ${file.name}...`;
    const formData = new FormData();
    formData.append('file', file);
    
    let path = file.webkitRelativePath || file.name;
    
    // If flatten is checked and this is a folder upload, strip the first folder name
    if (flattenFolder && file.webkitRelativePath) {
      const parts = file.webkitRelativePath.split('/');
      if (parts.length > 1) {
        path = parts.slice(1).join('/');
      }
    }
    
    formData.append('path', path);
    
    try {
      const headers = {};
      if (window.hankoToken) {
        headers['Authorization'] = 'Bearer ' + window.hankoToken;
      }
      
      const res = await fetch('/api/files', {
        method: 'POST',
        headers: headers,
        body: formData
      });
      
      if (!res.ok) {
        status.textContent = `âŒ Upload failed (${count}/${files.length}): ${file.name}`;
        return;
      }
      
      // Small delay between uploads to avoid rate limiting
      if (count < files.length) {
        await new Promise(resolve => setTimeout(resolve, 300));
      }
    } catch (err) {
      status.textContent = `âŒ Error: ${err.message}`;
      return;
    }
  }
  
  status.textContent = `âœ… Uploaded ${files.length} file(s)!`;
  filesInput.value = '';
  folderInput.value = '';
});

// Create starter page handler
document.getElementById('createStarter')?.addEventListener('click', async () => {
  const btn = document.getElementById('createStarter');
  const status = document.getElementById('starterStatus');
  
  btn.disabled = true;
  status.textContent = ' â³ Creating...';
  
  try {
    const res = await fetch('/api/create-starter', {
      method: 'POST',
      headers: { 'Authorization': 'Bearer ' + window.hankoToken }
    });
    
    if (res.ok) {
      status.textContent = ' âœ… Created!';
      document.getElementById('starterSection').style.display = 'none';
      setTimeout(() => {
        window.location.href = document.getElementById('link').href;
      }, 1000);
    } else {
      status.textContent = ' âŒ Failed';
      btn.disabled = false;
    }
  } catch (err) {
    status.textContent = ' âŒ Error';
    btn.disabled = false;
  }
});

// Make hankoToken available globally
window.hankoToken = null;
</script>
<div class="construction">
ğŸš§ Under Construction ğŸš§
</div>
<footer style="text-align:center;margin-top:40px;padding-top:20px;border-top:2px groove #999;font-size:0.9em">
by <a href="/~dmytri" rel="noopener">~dmytri</a> &nbsp;|&nbsp; <a href="/about">about</a> &nbsp;|&nbsp; <a href="/faq">faq</a><br>
Last updated: Monday, September 11759, 1993
</footer>
</main>
</body>
</html>
